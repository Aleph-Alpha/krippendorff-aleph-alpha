stages:
  - lint
  - typecheck
  - security
  - test
  - release

variables:
  PIP_DISABLE_PIP_VERSION_CHECK: "1"
  UV_CACHE_DIR: "$CI_PROJECT_DIR/.uv-cache"
  PYTHON_VERSION: "3.13"

default:
  image: python:3.13

before_script:
  - python -m pip install --upgrade pip
  - pip install uv
  - uv python install $PYTHON_VERSION
  - uv sync

lint:
  stage: lint
  script:
    - uv run lint
    - uv run format --check.jsonl

typecheck:
  stage: typecheck
  script:
    - uv run typecheck

security:
  stage: security
  script:
    - uv run bandit -r src/

test:
  stage: test
  script:
    - uv run test